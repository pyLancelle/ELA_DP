# =============================================================================
# GARMIN ACTIVITIES - COMPLETE INGESTION CONFIGURATION
# =============================================================================
# This configuration defines the complete ingestion pipeline for Garmin activities
# with 100% JSON coverage - all 128 paths mapped to typed BigQuery columns.
#
# Version: 3.0.0 (Complete coverage with camelCase field names)
# =============================================================================

# Metadata
data_type: activities
description: "Garmin activities with complete field coverage (128 paths)"
version: "3.0.0"
owner: "data-platform"
last_updated: "2025-10-31"

# =============================================================================
# SOURCE CONFIGURATION
# =============================================================================
source:
  bucket_pattern: "ela-dp-{env}"
  landing_path: "garmin/landing"
  file_pattern: "*_activities.jsonl"

  archive_path: "garmin/archive"
  rejected_path: "garmin/rejected"

  delete_after_archive: false
  max_file_age_days: 30

# =============================================================================
# DESTINATION CONFIGURATION
# =============================================================================
destination:
  project_id: "${GCP_PROJECT_ID}"
  dataset_pattern: "dp_lake_{env}"
  table_name: "lake_garmin__normalized_activities"

  write_disposition: "WRITE_APPEND"
  create_disposition: "CREATE_IF_NEEDED"

  partition:
    enabled: true
    field: "dp_inserted_at"
    type: "DAY"
    expiration_days: null

  clustering:
    enabled: true
    fields:
      - "activityId"
      - "ownerId"
      - "sportTypeId"

# =============================================================================
# PARSING CONFIGURATION
# =============================================================================
parsing:
  strategy: "hybrid"

  core_fields:
    - name: activityId
      json_path: "$.activityId"
      bq_type: INT64
      mode: REQUIRED
      description: "Unique activity identifier from Garmin"

    - name: activityName
      json_path: "$.activityName"
      bq_type: STRING
      mode: NULLABLE
      description: "User-defined or auto-generated activity name"

    - name: startTimeLocal
      json_path: "$.startTimeLocal"
      bq_type: TIMESTAMP
      mode: NULLABLE
      description: "Activity start time in local timezone"
      transform: "string_to_timestamp"

    - name: startTimeGMT
      json_path: "$.startTimeGMT"
      bq_type: TIMESTAMP
      mode: REQUIRED
      description: "Activity start time in GMT"
      transform: "string_to_timestamp"

    - name: activityType
      json_path: "$.activityType"
      bq_type: RECORD
      mode: NULLABLE
      description: "activityType details"
      fields:
        - name: typeId
          json_path: "$.typeId"
          bq_type: INT64
          mode: NULLABLE
          description: "typeId from Garmin activity data"

        - name: typeKey
          json_path: "$.typeKey"
          bq_type: STRING
          mode: NULLABLE
          description: "typeKey from Garmin activity data"

        - name: parentTypeId
          json_path: "$.parentTypeId"
          bq_type: INT64
          mode: NULLABLE
          description: "parentTypeId from Garmin activity data"

        - name: isHidden
          json_path: "$.isHidden"
          bq_type: BOOL
          mode: NULLABLE
          description: "isHidden from Garmin activity data"

        - name: restricted
          json_path: "$.restricted"
          bq_type: BOOL
          mode: NULLABLE
          description: "restricted from Garmin activity data"

        - name: trimmable
          json_path: "$.trimmable"
          bq_type: BOOL
          mode: NULLABLE
          description: "trimmable from Garmin activity data"


    - name: eventType
      json_path: "$.eventType"
      bq_type: RECORD
      mode: NULLABLE
      description: "eventType details"
      fields:
        - name: typeId
          json_path: "$.typeId"
          bq_type: INT64
          mode: NULLABLE
          description: "typeId from Garmin activity data"

        - name: typeKey
          json_path: "$.typeKey"
          bq_type: STRING
          mode: NULLABLE
          description: "typeKey from Garmin activity data"

        - name: sortOrder
          json_path: "$.sortOrder"
          bq_type: INT64
          mode: NULLABLE
          description: "sortOrder from Garmin activity data"


    - name: distance
      json_path: "$.distance"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Total distance in meters"

    - name: duration
      json_path: "$.duration"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Total duration in seconds"

    - name: elapsedDuration
      json_path: "$.elapsedDuration"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Elapsed duration including pauses"

    - name: movingDuration
      json_path: "$.movingDuration"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Moving duration excluding stops"

    - name: elevationGain
      json_path: "$.elevationGain"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Total elevation gain in meters"

    - name: elevationLoss
      json_path: "$.elevationLoss"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Total elevation loss in meters"

    - name: averageSpeed
      json_path: "$.averageSpeed"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Average speed in m/s"

    - name: maxSpeed
      json_path: "$.maxSpeed"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Maximum speed in m/s"

    - name: startLatitude
      json_path: "$.startLatitude"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "startLatitude from Garmin activity data"

    - name: startLongitude
      json_path: "$.startLongitude"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "startLongitude from Garmin activity data"

    - name: hasPolyline
      json_path: "$.hasPolyline"
      bq_type: BOOL
      mode: NULLABLE
      description: "hasPolyline from Garmin activity data"

    - name: hasImages
      json_path: "$.hasImages"
      bq_type: BOOL
      mode: NULLABLE
      description: "hasImages from Garmin activity data"

    - name: ownerId
      json_path: "$.ownerId"
      bq_type: INT64
      mode: NULLABLE
      description: "Garmin user ID"

    - name: ownerDisplayName
      json_path: "$.ownerDisplayName"
      bq_type: STRING
      mode: NULLABLE
      description: "ownerDisplayName from Garmin activity data"

    - name: ownerFullName
      json_path: "$.ownerFullName"
      bq_type: STRING
      mode: NULLABLE
      description: "ownerFullName from Garmin activity data"

    - name: ownerProfileImageUrlSmall
      json_path: "$.ownerProfileImageUrlSmall"
      bq_type: STRING
      mode: NULLABLE
      description: "ownerProfileImageUrlSmall from Garmin activity data"

    - name: ownerProfileImageUrlMedium
      json_path: "$.ownerProfileImageUrlMedium"
      bq_type: STRING
      mode: NULLABLE
      description: "ownerProfileImageUrlMedium from Garmin activity data"

    - name: ownerProfileImageUrlLarge
      json_path: "$.ownerProfileImageUrlLarge"
      bq_type: STRING
      mode: NULLABLE
      description: "ownerProfileImageUrlLarge from Garmin activity data"

    - name: calories
      json_path: "$.calories"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Total calories burned"

    - name: bmrCalories
      json_path: "$.bmrCalories"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "bmrCalories from Garmin activity data"

    - name: averageHR
      json_path: "$.averageHR"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Average heart rate in bpm"

    - name: maxHR
      json_path: "$.maxHR"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "Maximum heart rate in bpm"

    - name: averageRunningCadenceInStepsPerMinute
      json_path: "$.averageRunningCadenceInStepsPerMinute"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "averageRunningCadenceInStepsPerMinute from Garmin activity data"

    - name: maxRunningCadenceInStepsPerMinute
      json_path: "$.maxRunningCadenceInStepsPerMinute"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "maxRunningCadenceInStepsPerMinute from Garmin activity data"

    - name: steps
      json_path: "$.steps"
      bq_type: INT64
      mode: NULLABLE
      description: "steps from Garmin activity data"

    - name: userRoles
      json_path: "$.userRoles"
      bq_type: JSON
      mode: NULLABLE
      description: "User roles array (stored as JSON)"

    - name: privacy
      json_path: "$.privacy"
      bq_type: RECORD
      mode: NULLABLE
      description: "privacy details"
      fields:
        - name: typeId
          json_path: "$.typeId"
          bq_type: INT64
          mode: NULLABLE
          description: "typeId from Garmin activity data"

        - name: typeKey
          json_path: "$.typeKey"
          bq_type: STRING
          mode: NULLABLE
          description: "typeKey from Garmin activity data"


    - name: userPro
      json_path: "$.userPro"
      bq_type: BOOL
      mode: NULLABLE
      description: "userPro from Garmin activity data"

    - name: hasVideo
      json_path: "$.hasVideo"
      bq_type: BOOL
      mode: NULLABLE
      description: "hasVideo from Garmin activity data"

    - name: timeZoneId
      json_path: "$.timeZoneId"
      bq_type: INT64
      mode: NULLABLE
      description: "timeZoneId from Garmin activity data"

    - name: beginTimestamp
      json_path: "$.beginTimestamp"
      bq_type: INT64
      mode: NULLABLE
      description: "beginTimestamp from Garmin activity data"

    - name: sportTypeId
      json_path: "$.sportTypeId"
      bq_type: INT64
      mode: NULLABLE
      description: "Sport type identifier"

    - name: avgPower
      json_path: "$.avgPower"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "avgPower from Garmin activity data"

    - name: maxPower
      json_path: "$.maxPower"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "maxPower from Garmin activity data"

    - name: aerobicTrainingEffect
      json_path: "$.aerobicTrainingEffect"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "aerobicTrainingEffect from Garmin activity data"

    - name: anaerobicTrainingEffect
      json_path: "$.anaerobicTrainingEffect"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "anaerobicTrainingEffect from Garmin activity data"

    - name: normPower
      json_path: "$.normPower"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "normPower from Garmin activity data"

    - name: avgVerticalOscillation
      json_path: "$.avgVerticalOscillation"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "avgVerticalOscillation from Garmin activity data"

    - name: avgGroundContactTime
      json_path: "$.avgGroundContactTime"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "avgGroundContactTime from Garmin activity data"

    - name: avgStrideLength
      json_path: "$.avgStrideLength"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "avgStrideLength from Garmin activity data"

    - name: vO2MaxValue
      json_path: "$.vO2MaxValue"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "VO2 Max value"

    - name: avgVerticalRatio
      json_path: "$.avgVerticalRatio"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "avgVerticalRatio from Garmin activity data"

    - name: deviceId
      json_path: "$.deviceId"
      bq_type: INT64
      mode: NULLABLE
      description: "Device identifier"

    - name: minTemperature
      json_path: "$.minTemperature"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "minTemperature from Garmin activity data"

    - name: maxTemperature
      json_path: "$.maxTemperature"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "maxTemperature from Garmin activity data"

    - name: minElevation
      json_path: "$.minElevation"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "minElevation from Garmin activity data"

    - name: maxElevation
      json_path: "$.maxElevation"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "maxElevation from Garmin activity data"

    - name: maxDoubleCadence
      json_path: "$.maxDoubleCadence"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "maxDoubleCadence from Garmin activity data"

    - name: summarizedDiveInfo
      json_path: "$.summarizedDiveInfo"
      bq_type: RECORD
      mode: NULLABLE
      description: "summarizedDiveInfo details"
      fields:
        - name: summarizedDiveGases
          json_path: "$.summarizedDiveGases"
          bq_type: JSON
          mode: NULLABLE
          description: "Dive gases array (stored as JSON)"

    - name: maxVerticalSpeed
      json_path: "$.maxVerticalSpeed"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "maxVerticalSpeed from Garmin activity data"

    - name: manufacturer
      json_path: "$.manufacturer"
      bq_type: STRING
      mode: NULLABLE
      description: "manufacturer from Garmin activity data"

    - name: locationName
      json_path: "$.locationName"
      bq_type: STRING
      mode: NULLABLE
      description: "locationName from Garmin activity data"

    - name: lapCount
      json_path: "$.lapCount"
      bq_type: INT64
      mode: NULLABLE
      description: "lapCount from Garmin activity data"

    - name: endLatitude
      json_path: "$.endLatitude"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "endLatitude from Garmin activity data"

    - name: endLongitude
      json_path: "$.endLongitude"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "endLongitude from Garmin activity data"

    - name: waterEstimated
      json_path: "$.waterEstimated"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "waterEstimated from Garmin activity data"

    - name: trainingEffectLabel
      json_path: "$.trainingEffectLabel"
      bq_type: STRING
      mode: NULLABLE
      description: "trainingEffectLabel from Garmin activity data"

    - name: activityTrainingLoad
      json_path: "$.activityTrainingLoad"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "activityTrainingLoad from Garmin activity data"

    - name: minActivityLapDuration
      json_path: "$.minActivityLapDuration"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "minActivityLapDuration from Garmin activity data"

    - name: aerobicTrainingEffectMessage
      json_path: "$.aerobicTrainingEffectMessage"
      bq_type: STRING
      mode: NULLABLE
      description: "aerobicTrainingEffectMessage from Garmin activity data"

    - name: anaerobicTrainingEffectMessage
      json_path: "$.anaerobicTrainingEffectMessage"
      bq_type: STRING
      mode: NULLABLE
      description: "anaerobicTrainingEffectMessage from Garmin activity data"

    - name: splitSummaries
      json_path: "$.splitSummaries"
      bq_type: RECORD
      mode: REPEATED
      description: "splitSummaries array"
      fields:
        - name: noOfSplits
          json_path: "$[*].noOfSplits"
          bq_type: INT64
          mode: NULLABLE
          description: "noOfSplits from Garmin activity data"

        - name: totalAscent
          json_path: "$[*].totalAscent"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "totalAscent from Garmin activity data"

        - name: duration
          json_path: "$[*].duration"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "Total duration in seconds"

        - name: splitType
          json_path: "$[*].splitType"
          bq_type: STRING
          mode: NULLABLE
          description: "splitType from Garmin activity data"

        - name: numClimbSends
          json_path: "$[*].numClimbSends"
          bq_type: INT64
          mode: NULLABLE
          description: "numClimbSends from Garmin activity data"

        - name: maxElevationGain
          json_path: "$[*].maxElevationGain"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "maxElevationGain from Garmin activity data"

        - name: averageElevationGain
          json_path: "$[*].averageElevationGain"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "averageElevationGain from Garmin activity data"

        - name: maxDistance
          json_path: "$[*].maxDistance"
          bq_type: INT64
          mode: NULLABLE
          description: "maxDistance from Garmin activity data"

        - name: distance
          json_path: "$[*].distance"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "Total distance in meters"

        - name: averageSpeed
          json_path: "$[*].averageSpeed"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "Average speed in m/s"

        - name: maxSpeed
          json_path: "$[*].maxSpeed"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "Maximum speed in m/s"

        - name: numFalls
          json_path: "$[*].numFalls"
          bq_type: INT64
          mode: NULLABLE
          description: "numFalls from Garmin activity data"

        - name: elevationLoss
          json_path: "$[*].elevationLoss"
          bq_type: FLOAT64
          mode: NULLABLE
          description: "Total elevation loss in meters"


    - name: hasSplits
      json_path: "$.hasSplits"
      bq_type: BOOL
      mode: NULLABLE
      description: "hasSplits from Garmin activity data"

    - name: moderateIntensityMinutes
      json_path: "$.moderateIntensityMinutes"
      bq_type: INT64
      mode: NULLABLE
      description: "moderateIntensityMinutes from Garmin activity data"

    - name: vigorousIntensityMinutes
      json_path: "$.vigorousIntensityMinutes"
      bq_type: INT64
      mode: NULLABLE
      description: "vigorousIntensityMinutes from Garmin activity data"

    - name: avgGradeAdjustedSpeed
      json_path: "$.avgGradeAdjustedSpeed"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "avgGradeAdjustedSpeed from Garmin activity data"

    - name: differenceBodyBattery
      json_path: "$.differenceBodyBattery"
      bq_type: INT64
      mode: NULLABLE
      description: "differenceBodyBattery from Garmin activity data"

    - name: hasHeatMap
      json_path: "$.hasHeatMap"
      bq_type: BOOL
      mode: NULLABLE
      description: "hasHeatMap from Garmin activity data"

    - name: fastestSplit_1000
      json_path: "$.fastestSplit_1000"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "fastestSplit_1000 from Garmin activity data"

    - name: fastestSplit_1609
      json_path: "$.fastestSplit_1609"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "fastestSplit_1609 from Garmin activity data"

    - name: fastestSplit_5000
      json_path: "$.fastestSplit_5000"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "fastestSplit_5000 from Garmin activity data"

    - name: fastestSplit_10000
      json_path: "$.fastestSplit_10000"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "fastestSplit_10000 from Garmin activity data"

    - name: fastestSplit_21098
      json_path: "$.fastestSplit_21098"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "fastestSplit_21098 from Garmin activity data"

    - name: fastestSplit_42195
      json_path: "$.fastestSplit_42195"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "fastestSplit_42195 from Garmin activity data"

    - name: hrTimeInZone_1
      json_path: "$.hrTimeInZone_1"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "hrTimeInZone_1 from Garmin activity data"

    - name: hrTimeInZone_2
      json_path: "$.hrTimeInZone_2"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "hrTimeInZone_2 from Garmin activity data"

    - name: hrTimeInZone_3
      json_path: "$.hrTimeInZone_3"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "hrTimeInZone_3 from Garmin activity data"

    - name: hrTimeInZone_4
      json_path: "$.hrTimeInZone_4"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "hrTimeInZone_4 from Garmin activity data"

    - name: hrTimeInZone_5
      json_path: "$.hrTimeInZone_5"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "hrTimeInZone_5 from Garmin activity data"

    - name: powerTimeInZone_1
      json_path: "$.powerTimeInZone_1"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "powerTimeInZone_1 from Garmin activity data"

    - name: powerTimeInZone_2
      json_path: "$.powerTimeInZone_2"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "powerTimeInZone_2 from Garmin activity data"

    - name: powerTimeInZone_3
      json_path: "$.powerTimeInZone_3"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "powerTimeInZone_3 from Garmin activity data"

    - name: powerTimeInZone_4
      json_path: "$.powerTimeInZone_4"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "powerTimeInZone_4 from Garmin activity data"

    - name: powerTimeInZone_5
      json_path: "$.powerTimeInZone_5"
      bq_type: FLOAT64
      mode: NULLABLE
      description: "powerTimeInZone_5 from Garmin activity data"

    - name: endTimeGMT
      json_path: "$.endTimeGMT"
      bq_type: TIMESTAMP
      mode: NULLABLE
      description: "Activity end time in GMT"
      transform: "string_to_timestamp"

    - name: qualifyingDive
      json_path: "$.qualifyingDive"
      bq_type: BOOL
      mode: NULLABLE
      description: "qualifyingDive from Garmin activity data"

    - name: autoCalcCalories
      json_path: "$.autoCalcCalories"
      bq_type: BOOL
      mode: NULLABLE
      description: "autoCalcCalories from Garmin activity data"

    - name: favorite
      json_path: "$.favorite"
      bq_type: BOOL
      mode: NULLABLE
      description: "favorite from Garmin activity data"

    - name: decoDive
      json_path: "$.decoDive"
      bq_type: BOOL
      mode: NULLABLE
      description: "decoDive from Garmin activity data"

    - name: purposeful
      json_path: "$.purposeful"
      bq_type: BOOL
      mode: NULLABLE
      description: "purposeful from Garmin activity data"

    - name: pr
      json_path: "$.pr"
      bq_type: BOOL
      mode: NULLABLE
      description: "pr from Garmin activity data"

    - name: manualActivity
      json_path: "$.manualActivity"
      bq_type: BOOL
      mode: NULLABLE
      description: "manualActivity from Garmin activity data"

    - name: parent
      json_path: "$.parent"
      bq_type: BOOL
      mode: NULLABLE
      description: "parent from Garmin activity data"

    - name: elevationCorrected
      json_path: "$.elevationCorrected"
      bq_type: BOOL
      mode: NULLABLE
      description: "elevationCorrected from Garmin activity data"

    - name: atpActivity
      json_path: "$.atpActivity"
      bq_type: BOOL
      mode: NULLABLE
      description: "atpActivity from Garmin activity data"

  # ===========================================================================
  # EXTENDED FIELDS (All fields are core for this complete configuration)
  # ===========================================================================
  extended_fields_reference:
    note: "All 125 paths are included as core fields - no extended fields in raw_data only"

# =============================================================================
# METADATA FIELDS
# =============================================================================
metadata_fields:
  - name: raw_data
    bq_type: JSON
    mode: NULLABLE
    description: "Complete activity JSON for reference"

  - name: dp_inserted_at
    bq_type: TIMESTAMP
    mode: REQUIRED
    description: "Timestamp when record was ingested"
    default: "CURRENT_TIMESTAMP"

  - name: source_file
    bq_type: STRING
    mode: NULLABLE
    description: "Source JSONL filename"

# =============================================================================
# QUALITY CHECKS
# =============================================================================
quality_checks:
  unique_key: activityId
  deduplication_strategy: "keep_latest"

  required_fields:
    - activityId
    - startTimeGMT

  validation_mode: "warn"

  null_handling:
    strategy: "allow"
    replacement_values: {}

# =============================================================================
# TRANSFORMATIONS
# =============================================================================
transformations:
  string_to_timestamp:
    description: "Convert string timestamp to BigQuery TIMESTAMP"
    logic: "datetime.strptime(value, '%Y-%m-%d %H:%M:%S')"

  timestamp_ms_to_timestamp:
    description: "Convert milliseconds epoch to BigQuery TIMESTAMP"
    logic: "datetime.fromtimestamp(value / 1000)"

# =============================================================================
# PERFORMANCE CONFIGURATION
# =============================================================================
performance:
  batch_size: 500
  max_batch_size_mb: 10
  max_workers: 4
  parallel_file_limit: 10
  max_memory_mb: 2048
  stream_large_files: true
  bq_job_timeout_seconds: 600
  gcs_download_timeout: 300

  retry:
    enabled: true
    max_attempts: 3
    backoff_seconds: 5
    backoff_multiplier: 2

# =============================================================================
# LOGGING
# =============================================================================
logging:
  level: INFO
  console: true
  file: false
  include_sample_records: true
  max_sample_records: 3
  log_rejected_records: true
  track_metrics: true
# =============================================================================
# ALERTING
# =============================================================================
alerting:
  enabled: false

  conditions:
    - name: high_rejection_rate
      threshold: 0.1

    - name: no_data
      threshold: 0

    - name: processing_time
      threshold: 600

  channels:
    - email
    - slack

# =============================================================================
# EXAMPLES
# =============================================================================
examples:
  - name: "Ingest activities to dev"
    command: "python -m src.connectors.garmin.garmin_ingest_v2 --config activities --env dev"

  - name: "Ingest activities to prod"
    command: "python -m src.connectors.garmin.garmin_ingest_v2 --config activities --env prd"

  - name: "Dry run"
    command: "python -m src.connectors.garmin.garmin_ingest_v2 --config activities --env dev --dry-run"

  - name: "Verbose logging"
    command: "python -m src.connectors.garmin.garmin_ingest_v2 --config activities --env dev --log-level DEBUG"
