SELECT
		userProfileId,
		totalKilocalories,
		activeKilocalories,
		bmrKilocalories,
		wellnessKilocalories,
		remainingKilocalories,
		totalSteps,
		totalDistanceMeters,
		wellnessDistanceMeters,
		wellnessActiveKilocalories,
		netRemainingKilocalories,
		userDailySummaryId,
		calendarDate,
		rule,
		uuid,
		dailyStepGoal,
		wellnessStartTimeGmt,
		wellnessStartTimeLocal,
		wellnessEndTimeGmt,
		wellnessEndTimeLocal,
		durationInMilliseconds,
		highlyActiveSeconds,
		activeSeconds,
		sedentarySeconds,
		sleepingSeconds,
		includesWellnessData,
		includesActivityData,
		includesCalorieConsumedData,
		privacyProtected,
		moderateIntensityMinutes,
		vigorousIntensityMinutes,
		floorsAscendedInMeters,
		floorsDescendedInMeters,
		floorsAscended,
		floorsDescended,
		intensityMinutesGoal,
		userFloorsAscendedGoal,
		minHeartRate,
		maxHeartRate,
		restingHeartRate,
		lastSevenDaysAvgRestingHeartRate,
		`source`,
		averageStressLevel,
		maxStressLevel,
		stressDuration,
		restStressDuration,
		activityStressDuration,
		uncategorizedStressDuration,
		totalStressDuration,
		lowStressDuration,
		mediumStressDuration,
		highStressDuration,
		stressPercentage,
		restStressPercentage,
		activityStressPercentage,
		uncategorizedStressPercentage,
		lowStressPercentage,
		mediumStressPercentage,
		highStressPercentage,
		stressQualifier,
		measurableAwakeDuration,
		measurableAsleepDuration,
		minAvgHeartRate,
		maxAvgHeartRate,
		bodyBatteryChargedValue,
		bodyBatteryDrainedValue,
		bodyBatteryHighestValue,
		bodyBatteryLowestValue,
		bodyBatteryMostRecentValue,
		bodyBatteryVersion,
		averageMonitoringEnvironmentAltitude,
		restingCaloriesFromActivity,
		avgWakingRespirationValue,
		highestRespirationValue,
		lowestRespirationValue,
		latestRespirationValue,
		latestRespirationTimeGMT,
		`from`,
		until,
		weight,
		`date`,
		data_type,
		TIMESTAMP(`_dp_inserted_at`) AS _dp_inserted_at,
		`_source_file`,
		bodyBatteryDuringSleep,
		bodyBatteryDynamicFeedbackEvent,
		bodyBatteryActivityEventList,
		bmi,
		bodyFat,
		bodyWater,
		boneMass,
		muscleMass,
		endOfDayBodyBatteryDynamicFeedbackEvent,
		averageSpo2,
		lowestSpo2,
		latestSpo2,
		latestSpo2ReadingTimeGmt,
		latestSpo2ReadingTimeLocal,
		abnormalHeartRateAlertsCount,
		respirationAlgorithmVersion,
		bodyBatteryAtWakeTime,
		lastSyncTimestampGMT
FROM {{ source('garmin','stats_and_body') }}
QUALIFY ROW_NUMBER() OVER (PARTITION BY calendardate ORDER BY TIMESTAMP(_dp_inserted_at) DESC) = 1
