# ELA Data Platform - PRD Environment Ingestion Configuration
# This file defines all data ingestion jobs for PRODUCTION environment
# PRD environment uses optimized schedules for production workloads

# Global Configuration
global:
  timezone: "Europe/Paris"
  retry_attempts: 3
  max_parallel_jobs: 5
  gcs_bucket: "ela-dp-prd"
  timeout_minutes: 45
  environment: "prd"

# Job Groups for manual execution
job_groups:
  spotify_all:
    description: "All Spotify data sources (PRD)"
    jobs: ["spotify_recently_played", "spotify_saved_tracks", "spotify_saved_albums", "spotify_playlists", "spotify_top_tracks", "spotify_top_artists"]
  
  fitness_all:
    description: "All fitness data sources (PRD)"
    jobs: ["strava_activities", "strava_athlete", "garmin_activities", "garmin_sleep", "garmin_heart_rate"]
  
  productivity_all:
    description: "All productivity data sources (PRD)"
    jobs: ["todoist_tasks", "todoist_projects"]
  
  daily_jobs:
    description: "Jobs that run daily (PRD)"
    jobs: ["garmin_sleep", "todoist_projects"]
  
  weekly_jobs:
    description: "Jobs that run weekly (PRD)"
    jobs: ["spotify_saved_tracks", "spotify_saved_albums", "strava_athlete"]
  
  monthly_jobs:
    description: "Jobs that run monthly (PRD)"
    jobs: ["spotify_playlists", "spotify_top_tracks", "spotify_top_artists"]

  # New pipeline groups
  garmin_pipeline:
    description: "Complete Garmin pipeline (fetch + ingest)"
    jobs: ["garmin_activities", "garmin_sleep", "garmin_heart_rate", "garmin_ingest"]
  
  strava_pipeline:
    description: "Complete Strava pipeline (fetch + ingest)"
    jobs: ["strava_activities", "strava_athlete", "strava_ingest"]
  
  ingestion_only:
    description: "Run only ingestion jobs (GCS â†’ BigQuery)"
    jobs: ["garmin_ingest", "strava_ingest"]

# Individual Jobs Configuration - PRD Environment
jobs:
  # =================== SPOTIFY JOBS (PRD) ===================
  spotify_recently_played:
    service: "spotify"
    data_type: "recently_played"
    description: "Fetch recently played tracks from Spotify (PRD)"
    cron: "0 */3 * * *"  # Every 3 hours for production
    command: "python -m src.connectors.spotify.spotify_fetch recently_played --limit 50"
    environment: "prd"
    enabled: true
    dependencies: ["SPOTIFY_CLIENT_ID", "SPOTIFY_CLIENT_SECRET", "SPOTIFY_REDIRECT_URI", "SPOTIFY_REFRESH_TOKEN"]

  spotify_saved_tracks:
    service: "spotify"
    data_type: "saved_tracks"
    description: "Fetch saved tracks from Spotify (PRD)"
    cron: "0 6 * * 0"  # Weekly on Sundays at 6:00 UTC
    command: "python -m src.connectors.spotify.spotify_fetch saved_tracks --limit 1000"
    environment: "prd"
    enabled: true
    dependencies: ["SPOTIFY_CLIENT_ID", "SPOTIFY_CLIENT_SECRET", "SPOTIFY_REDIRECT_URI", "SPOTIFY_REFRESH_TOKEN"]

  spotify_saved_albums:
    service: "spotify"
    data_type: "saved_albums"
    description: "Fetch saved albums from Spotify (PRD)"
    cron: "0 7 * * 0"  # Weekly on Sundays at 7:00 UTC
    command: "python -m src.connectors.spotify.spotify_fetch saved_albums --limit 200"
    environment: "prd"
    enabled: true
    dependencies: ["SPOTIFY_CLIENT_ID", "SPOTIFY_CLIENT_SECRET", "SPOTIFY_REDIRECT_URI", "SPOTIFY_REFRESH_TOKEN"]

  spotify_playlists:
    service: "spotify"
    data_type: "playlists"
    description: "Fetch user playlists from Spotify (PRD)"
    cron: "0 8 1 * *"  # Monthly on 1st day at 8:00 UTC
    command: "python -m src.connectors.spotify.spotify_fetch playlists --limit 100"
    environment: "prd"
    enabled: true
    dependencies: ["SPOTIFY_CLIENT_ID", "SPOTIFY_CLIENT_SECRET", "SPOTIFY_REDIRECT_URI", "SPOTIFY_REFRESH_TOKEN"]

  spotify_top_tracks:
    service: "spotify"
    data_type: "top_tracks"
    description: "Fetch top tracks from Spotify (PRD)"
    cron: "0 9 1 * *"  # Monthly on 1st day at 9:00 UTC
    command: "python -m src.connectors.spotify.spotify_fetch top_tracks --limit 50 --time-range medium_term"
    environment: "prd"
    enabled: true
    dependencies: ["SPOTIFY_CLIENT_ID", "SPOTIFY_CLIENT_SECRET", "SPOTIFY_REDIRECT_URI", "SPOTIFY_REFRESH_TOKEN"]

  spotify_top_artists:
    service: "spotify"
    data_type: "top_artists"
    description: "Fetch top artists from Spotify (PRD)"
    cron: "0 10 1 * *"  # Monthly on 1st day at 10:00 UTC
    command: "python -m src.connectors.spotify.spotify_fetch top_artists --limit 50 --time-range medium_term"
    environment: "prd"
    enabled: true
    dependencies: ["SPOTIFY_CLIENT_ID", "SPOTIFY_CLIENT_SECRET", "SPOTIFY_REDIRECT_URI", "SPOTIFY_REFRESH_TOKEN"]

  # =================== STRAVA JOBS (PRD) ===================
  strava_activities:
    service: "strava"
    data_type: "activities"
    description: "Fetch activities from Strava (PRD)"
    cron: "0 */6 * * *"  # Every 6 hours for production
    command: "python -m src.connectors.strava.strava"
    environment: "prd"
    enabled: false
    dependencies: ["STRAVA_CLIENT_ID", "STRAVA_CLIENT_SECRET", "STRAVA_REFRESH_TOKEN"]

  strava_athlete:
    service: "strava"
    data_type: "athlete"
    description: "Fetch athlete profile from Strava (PRD)"
    cron: "0 6 * * 1"  # Weekly on Mondays at 6:00 UTC
    command: "python -m src.connectors.strava.strava --athlete"
    environment: "prd"
    enabled: false
    dependencies: ["STRAVA_CLIENT_ID", "STRAVA_CLIENT_SECRET", "STRAVA_REFRESH_TOKEN"]

  # =================== GARMIN JOBS (PRD) ===================
  garmin_activities:
    service: "garmin"
    data_type: "activities"
    description: "Fetch activities from Garmin (PRD)"
    cron: "0 */4 * * *"  # Every 4 hours for production
    command: "python -m src.connectors.garmin.garmin_fetch activities --days 7"
    environment: "prd"
    enabled: false
    dependencies: ["GARMIN_USERNAME", "GARMIN_PASSWORD"]

  garmin_sleep:
    service: "garmin"
    data_type: "sleep"
    description: "Fetch sleep data from Garmin (PRD)"
    cron: "0 8 * * *"  # Daily at 8:00 UTC
    command: "python -m src.connectors.garmin.garmin_fetch sleep --days 2"
    environment: "prd"
    enabled: false
    dependencies: ["GARMIN_USERNAME", "GARMIN_PASSWORD"]

  garmin_heart_rate:
    service: "garmin"
    data_type: "heart_rate"
    description: "Fetch heart rate data from Garmin (PRD)"
    cron: "0 */8 * * *"  # Every 8 hours for production
    command: "python -m src.connectors.garmin.garmin_fetch heart_rate --days 1"
    environment: "prd"
    enabled: false
    dependencies: ["GARMIN_USERNAME", "GARMIN_PASSWORD"]

  # =================== TODOIST JOBS (PRD) ===================
  todoist_tasks:
    service: "todoist"
    data_type: "tasks"
    description: "Fetch tasks from Todoist (PRD)"
    cron: "0 */4 * * *"  # Every 4 hours for production
    command: "python -m src.connectors.todoist.todoist tasks"
    environment: "prd"
    enabled: false
    dependencies: ["TODOIST_API_TOKEN"]

  todoist_projects:
    service: "todoist"
    data_type: "projects"
    description: "Fetch projects from Todoist (PRD)"
    cron: "0 7 * * *"  # Daily at 7:00 UTC
    command: "python -m src.connectors.todoist.todoist projects"
    environment: "prd"
    enabled: false
    dependencies: ["TODOIST_API_TOKEN"]

  # =================== INGESTION JOBS (PRD) ===================
  garmin_ingest:
    service: "garmin"
    data_type: "ingest"
    description: "Ingest Garmin data from GCS to BigQuery (PRD)"
    cron: "30 */4 * * *"  # 30 minutes after data fetch
    command: "python -m src.connectors.garmin.garmin_ingest --env prd --project ela-dp"
    environment: "prd"
    enabled: true
    dependencies: ["GCP_SERVICE_ACCOUNT_KEY", "GCP_PROJECT_ID"]

  strava_ingest:
    service: "strava"
    data_type: "ingest"
    description: "Ingest Strava data from GCS to BigQuery (PRD)"
    cron: "30 */6 * * *"  # 30 minutes after data fetch
    command: "python -m src.connectors.strava.strava_ingest --env prd --project ela-dp"
    environment: "prd"
    enabled: false  # Disabled until Strava OAuth is configured
    dependencies: ["GCP_SERVICE_ACCOUNT_KEY", "GCP_PROJECT_ID"]

# Service-specific configuration
services:
  spotify:
    base_path: "src/connectors/spotify"
    fetch_script: "spotify_fetch.py"
    default_limit: 50  # Full limits for PRD
    supported_data_types: ["recently_played", "saved_tracks", "saved_albums", "playlists", "top_tracks", "top_artists"]
  
  strava:
    base_path: "src/connectors/strava"
    fetch_script: "strava.py"
    supported_data_types: ["activities", "athlete"]
  
  garmin:
    base_path: "src/connectors/garmin"
    fetch_script: "garmin_fetch.py"
    supported_data_types: ["activities", "sleep", "heart_rate"]
  
  todoist:
    base_path: "src/connectors/todoist"
    fetch_script: "todoist.py"
    supported_data_types: ["tasks", "projects"]